# SP4RK開発メモ

## 何故DirectX11で開発したのか
* そもそも何故Unityなどのエンジンを使わずに実装するのか
    * 時間のある学生の間に、低レイヤから学ぼうと思ったため
    * モバイル向けゲーム業界への就職を考えた際に、今後ハイエンド化が加速するモバイル業界において、低レイヤを知っていることは差別化に繋がると思ったため
* VisualStudioの強力なグラフィックデバッガの支援を受けられる
* DirectX9のD3DX類の関数がブラックボックスなのが気に入らなかった
* GeometryShaderやComputeShaderなどDX11世代からの新技術に惹かれたから

## シングルトンに頼らない実装にしようとした
* 良くある実装 → シングルトン、グローバルに直置き
* シングルトンを使わない代わりに、コンストラクタで手動DIを行っていたが、辛くなった
* 既存のエンジンはどうしてるか
    * リファレンス代わりに読んでいるコードを参考に
        * Siv3Dやpomdogはサービスロケーターで解決していた
* 各モジュールのインスタンスを持つ、Appクラス(GameManager的なクラス)をサービスロケーターにした
    * Appクラスの参照から、各モジュールにアクセス出来るように
    * アクセスの際、デメテルの法則に違反しているし、綺麗では無い
* 次回設計する際には、C++でDIコンテナを導入出来る、[Boost].DIを試してみたい

## モダンなコードにする為の工夫
* 全てスマートポインタで管理する
    * std::shared_ptr, std::unique_ptr
    * COMもComPtrで管理
* モダンじゃないコード/命名違反はReSharper C++のlint機能に怒られる素敵環境
* 名前空間で囲う
* コードメトリクス計測
* 例外処理

## モデル形式にobj形式を使った理由
* 今回のゲームはアニメーションを使わないことが予想された為
* プリミティブなモデル形式を扱いたかった
* 枯れたパーサー(tinyobjloader)があった
* 以前のバージョンではpmxを使っていたが、以下の理由から廃止した
    * ガラパゴスフォーマットで有ること
    * 今回のゲームには不必要なデータが多分に含まれていた為

## パーティクルについて
* Easingで動きを説得力のあるものにした
* Bloomで更に鮮やかに

## 可変フレーム
* 可変フレームに対応
* EasingのTimeに依存した動きなどが、付けやすくなった

## ディレクトリ構成について
```
root/
├─ Assets/ (ゲーム内で使用する素材)
├─ Bin/ (実行ファイルや中間ファイルなど)
│    ├─ Release/
│    └─ Debug/
├─ Docs/ (クラス図などのドキュメント)
├─ Include/ (tinyobjloaderなどサードパーティのヘッダー)
├─ Lib/ (サードパーティなどのライブラリ)
├─ RawData/ (.aiや.blenderなど出力前の生データ)
├─ Source/ (自身で書いたコード)
├─ UnitTest/ (GoogleTest用のソリューション)
└─ DX11Project.sln
```
ひと目で分かりやすいディレクトリ構成を心掛けました

## 開発を通して様々なオープンソースなライブラリに触れた
* ImGui
    * 各種デバッグ情報表示
* cpptoml
    * コンフィグファイル読み込みに
* tinyobjloader
* tweeny
    * 採用しなかったものの、メソッドチェーンでトゥイーンが記述出来るAPIは興味深い
* Boost
* ライブラリを使うプログラマのUXが考えられていたり、コード自体が統一されたコンセプトの元しっかり書かれていたりする、GitHubStarが3桁以上有るようなライブラリから学ぶことは多いです

## 今後の発展について
* ComputeShader + GPUInstancingで沢山のパーティクルを飛ばす
* Luaで各種パラメータの制御
* ホットリロード
* ECSの組み込み
